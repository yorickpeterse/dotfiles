#!/usr/bin/env fish
#
# Usage: nvim-mergetool LOCAL REMOTE MERGED
#
# This script opens a new tab in NeoVim containing the LOCAL and REMOTE files,
# with the REMOTE buffer set to read-only, diagnostics disabled in both, and the
# active window set to the one containing the LOCAL file.
#
# The result is something that mimics nvimdiff1 but a bit better.

# We open the files in reverse order so -c options apply to the REMOTE file.
nvim \
    -c 'setlocal ro' \
    -c 'wincmd L' \
    -c 'lua vim.diagnostic.enable(false, { bufnr = 0 })' \
    -c 'wincmd h' \
    -d $argv[2] $argv[1]

# Git monitors the MERGED file, so we have to copy the changes made to LOCAL to
# this file.
cp $argv[1] $argv[3]
